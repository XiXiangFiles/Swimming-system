<!--
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
+-   Author : Wang Zi Xiang                   +- 
+-   Unit   : Nccu cs 						  +- 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- 
-->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Nccu cs Wang test system</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
	<span>帳號</span><input type="text" class="id"><span class="alert"></span><br>
	<span>密碼</span><input type="password" class="pwd"><br>
	<span>再輸入一次密碼</span><input type="password" class="pwd2"><br>
	<span>使用者名稱</span><input type="text" class="user_name"><br>
	<span>自介</span><input type="text" class="user_info"><br>
	<button class="send">送出</button>
</body>
<script>

	function check(email){
		let pattern = new RegExp('^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})*$');		
		if(email.match(pattern)){
			return true;
		}else{
			return false;
		}
	}
	$('.send').click(function () {
		let check_num=0;
		let id=$('.id').val();
		let pwd=$('.pwd').val();
		let pwd2=$('.pwd2').val();
		let user_name=$('.user_name').val();
		let user_info=$('.user_info').val();
		let data={};
		if(id.length==0 || !check(id)){
			$('.id').css({'background' : 'red'});
			
			if(check(id)==false){
				$('.alert').text("請輸入Email");
			}
		}else{
			$('.id').css({'background' : 'white'});
			$('.alert').css({"display": "none"});
			check_num++;
		}
		if(pwd.length==0){
			$('.pwd').css({'background' : 'red'});
		}else{
			$('.pwd').css({'background' : 'white'});
			check_num++;
		}
		if(pwd2.length==0){
			$('.pwd2').css({'background' : 'red'});
		}else{
			$('.pwd2').css({'background' : 'white'});
			check_num++;
		}
		if(user_name.length==0){
			$('.user_name').css({'background' : 'red'});
		}else{
			$('.user_name').css({'background' : 'white'});
			check_num++;
		}
		if(user_info.length==0){
			$('.user_info').css({'background' : 'red'});
		}else{
			$('.user_info').css({'background' : 'white'});
			check_num++;
		}
		if(pwd.length !=0 && pwd2.length !=0 && pwd!=pwd2){
			$('.pwd').css({'background' : 'green'});
			$('.pwd2').css({'background' : 'green'});
		}else{
			check_num++;
		}
		if(check_num==6){
			data.id=id;
			data.pwd=pwd;
			data.user_name=user_name;
			data.user_info=user_info;
			console.log(data);
			$.ajax({
				url:'model/register.php',
				type:'POST',
				cache:'false',
				data:data,
				success: function(result){
					if (result=="true") {
						document.location.href="index.html";
					}else{
						console.log(result);
						// JSON.stringify(result);
						let error=JSON.parse(result);
						$('.id').css({'background' : 'red'});
						$('.alert').text("Email 有人用了");
					}

				}

			});
		}

	});
</script>
</html>