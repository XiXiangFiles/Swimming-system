<!--
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
+-   Author : Wang Zi Xiang                   +- 
+-   Unit   : Nccu cs 						  +- 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- 
-->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Nccu cs Wang test system</title>
	<link rel="stylesheet" href="css/all.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="js/DomElements.js"></script>
	<script>
		let href,paremeter,token,data;
		try{
			href=location.href;
			paremeter=href.split('?');
			token=paremeter[1].split("=");
			data={};
			data.token=token[1];
			$.ajax({
				url:"model/check.php",
				type:"POST",
				data:data,
				success: function(result){
					console.log(result);
					if (result.trim()=="false") {
						document.location.href="index.html";
					}
				}
			});
		}catch(e){
			document.location.href="index.html";
		}
		
	</script>
</head>
</head>
<body>
	
	<div class="content">
		<button class="clock">clock</button>
		<button class="follow">Subscribe</button>
		<button class="logout">log out</button>
		<button class="setting_wrokshop">Set Workshop</button>
		<button class="setting_group">Set group</button>
		<div class="group">
			<div class="group_list">
				
			</div>
			<div class="increse_g">
				<p>List Group name</p><br><input type="text" class="group_name"><br>
				<p>list Group Info.</p><br><textarea class="group_info" id="" cols="30" rows="10"></textarea><br>
						<button class="ins_btn">Increase group</button>

			</div>
		</div>
	</div>
</body>
<script>
	let groupSet = new Set();
	let countSettingGroup=0;
	$('.clock').click(function(){
		document.location.href="clock.html?token="+token[1];
	});
	$('.follow').click(function(){
		document.location.href="follow.html?token="+token[1];
	});

	$('.logout').click(function(){
		$.ajax({
			url:'model/logout.php',
			async:false,
			success: function(result){
				console.log(result);
				document.location.href="index.html";
			}
		});
	});
	$('.setting_group').click(function(){
		let groupContent="";
		countSettingGroup++;
		if((countSettingGroup%2)==1){
			$('.group').css({
				"display":"block"	
			});
		}else{
			$('.group').css({
				"display":"none"	
			});
		}
		$.ajax({
                url:"model/list_group.php?token="+token[1],
                method: 'GET',
                cache: false,
                success:function(data_o){
                	// data_o=JSON.stringify(data_o);
                	if(data!=false){
                		let data=JSON.parse(data_o);
	                	for (let i =0 ; i<data.group.length; i++) {
		                		if(groupSet.has(data.group[i].T_num)==false){
		                		groupContent+=add_button("","groupList",data.group[i].T_name);
		                		console.log("groupContent="+groupContent);
		                		groupSet.add(data.group[i].T_num);
	                		}	
	                	}
	                	$('.group_list').append(groupContent);
                	}
                }
        });
	});
	$(".ins_btn").off().on('click',function(){
			let obj={};
			obj.token=token[1];
			obj.group_name=$('.group_name').val();
			obj.group_info=$('.group_info').val();
			$.ajax({
                url:"model/ins_grp.php",
                method: 'GET',
                data:obj,
                cache: false,
                success:function(data_o){
                	console.log(data_o);
                }
        });


    });

</script>
</html>